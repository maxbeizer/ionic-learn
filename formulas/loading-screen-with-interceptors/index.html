<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
    <meta charset='utf-8'>
    <title>Global Loading Screen with Interceptors | Formulas | Learn Ionic</title>
    <link href='/css/site.css' rel='stylesheet'>
    <link href='//cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.0/animate.min.css' rel='stylesheet'>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-44023830-6', 'ionicframework.com');
      ga('send', 'pageview');
    </script>
  </head>
  <body class='full-page no-js'>
    <script>
      document.body.classList.remove('no-js');
    </script>
    <div class='container'>
      <div class='row'>
        <div class='side-nav'>
          <div class='logo'>
            <a href='/'>
              <img alt='Learn Ionic Framework' height='43' src='/img/learn-ionicframework@2x.png' width='194'>
            </a>
          </div>
          <nav>
            <ul>
              <li>
                <a href='/videos/'>
                  <i class='ion-videos'></i>
                  <p>Videos</p>
                </a>
              </li>
              <li>
                <a class='active' href='/formulas/'>
                  <i class='ion-formulas'></i>
                  <p>Formulas</p>
                </a>
              </li>
              <li>
                <a href='/talks/'>
                  <i class='ion-talks'></i>
                  <p>Talks</p>
                </a>
              </li>
              <li>
                <a href='/resources/'>
                  <i class='ion-resources'></i>
                  <p>Resources</p>
                </a>
              </li>
            </ul>
            <footer>
              <ul>
                <li>
                  <a href='https://github.com/driftyco/ionic-learn/issues/new' target='_new'>
                    <i class='ion-suggestions'></i>
                    <p>Suggest a Topic</p>
                  </a>
                </li>
                <li>
                  <a href='http://forum.ionicframework.com/' target='_new'>
                    <i class='ion-forum'></i>
                    <p>Forums</p>
                  </a>
                </li>
                <li>
                  <a href='https://github.com/driftyco/ionic' target='_new'>
                    <i class='ion-github'></i>
                    <p>Github</p>
                  </a>
                </li>
                <li>
                  <a href='https://twitter.com/ionicframework' target='_new'>
                    <i class='ion-twitter'></i>
                    <p>Twitter</p>
                  </a>
                </li>
                <li>
                  <a href='https://plus.google.com/+Ionicframework/posts' target='_new'>
                    <i class='ion-googleplus'></i>
                    <p>Plus</p>
                  </a>
                </li>
              </ul>
            </footer>
            <form action='http://codiqa.createsend.com/t/t/s/thodi/' class='email-digest' method='post'>
              <label for='cm-thodi-thodi'>
                <p>Sign up for the weekly Learn Digest!</p>
              </label>
              <div class='digest-wrapper'>
                <input name='cm-thodi-thodi' placeholder='Email address' required type='email'>
                <input type='submit' value='Go'>
              </div>
            </form>
            <div class='email-digest-success'>
              <p>Thanks for signing up. Every Friday you'll get an update on all of the new and exciting lessons on Learn Ionic!</p>
            </div>
          </nav>
        </div>
        <div class='main-pane'>
          <div class='content formula'>
            <nav>
              <a class='left' href='/formulas/'>
                <i class='ion-chevron-left'></i>
                <span style='margin-left:0px;'>All Formulas</span>
              </a>
            </nav>
            <article>
              <header>
                <h1>Global Loading Screen with Interceptors</h1>
                <div class='byline'>
                  <img src='/img/authors/gerred-dillon.png'>
                  <span class='author'>
                    Written by
                    <a href='https://twitter.com/justicefries' target='_new'>Gerred Dillon</a>
                  </span>
                  <time></time>
                </div>
                <div class='social-buttons'>
                  <a href="https://twitter.com/share" class="twitter-share-button" data-via="ionicframework" data-related="ionicframework">Tweet</a>
                  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                </div>
              </header>
              <h2 id="showing-a-loading-screen">Showing a loading screen</h2>
              
              <p>Ionic ships with a built-in loading screen for making requests, disabling the UI and letting the user know that a blocking action is happening. To start, let’s get familiar with <code>$ionicLoading</code> by making an API request to the Open Beer Database. We will also use the <code>jsonp</code> function of the <code>$http</code> directive to make a cross domain request.</p>
              
              <div><div class="CodeRay">
                <div class="code"><pre>app.controller(<span class="string"><span class="delimiter">'</span><span class="content">MainCtrl</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(<span class="predefined">$http</span>, <span class="predefined">$ionicLoading</span>) {&#x000A;  <span class="keyword">var</span> _this = <span class="local-variable">this</span>&#x000A;  <span class="predefined">$ionicLoading</span>.show({&#x000A;    <span class="key">template</span>: <span class="string"><span class="delimiter">'</span><span class="content">loading</span><span class="delimiter">'</span></span>&#x000A;  })&#x000A;  <span class="predefined">$http</span>.jsonp(<span class="string"><span class="delimiter">'</span><span class="content">http://api.openbeerdatabase.com/v1/breweries.json?callback=JSON_CALLBACK</span><span class="delimiter">'</span></span>).then(<span class="keyword">function</span>(result) {&#x000A;    <span class="predefined">$ionicLoading</span>.hide()&#x000A;    _this.breweries = result.data.breweries&#x000A;  })&#x000A;})</pre></div>
              </div>
              </div>
              
              <p>This request is successful, and we can view a list of breweries. When this is run, a loading screen is shown, and disappears when the request finishes. While this achieves the intended effect, it is not exactly what we want.</p>
              
              <p>In the above example, other controllers and services making HTTP request would have to make use of the same code, causing repetition throughout the codebase. Changes to the loading screen would have to be made in multiple places.</p>
              
              <p>Even worse, our HTTP request (or service) must now concern itself with knowing about <code>$ionicLoading</code>, becoming tightly coupled to it’s implementation. Fortunately, there’s a better way.</p>
              
              <h2 id="enter-http-interceptors">Enter HTTP interceptors</h2>
              
              <p>Angular’s <code>$httpProvider</code> provider has the notion of interceptors, which allow us to inject code before a request is sent, and before a response is processed by a controller. Using this, we can centralize our app’s loading code to one place, ensuring that it is easily maintainable.</p>
              
              <p>As a result, there is more setup, as shown below:</p>
              
              <div><div class="CodeRay">
                <div class="code"><pre><span class="keyword">var</span> app = angular.module(<span class="string"><span class="delimiter">'</span><span class="content">ionicApp</span><span class="delimiter">'</span></span>, [<span class="string"><span class="delimiter">'</span><span class="content">ionic</span><span class="delimiter">'</span></span>])&#x000A;&#x000A;app.config(<span class="keyword">function</span>(<span class="predefined">$httpProvider</span>) {&#x000A;  <span class="predefined">$httpProvider</span>.interceptors.push(<span class="keyword">function</span>(<span class="predefined">$rootScope</span>) {&#x000A;    <span class="keyword">return</span> {&#x000A;      <span class="function">request</span>: <span class="keyword">function</span>(config) {&#x000A;        <span class="predefined">$rootScope</span>.<span class="predefined">$broadcast</span>(<span class="string"><span class="delimiter">'</span><span class="content">loading:show</span><span class="delimiter">'</span></span>)&#x000A;        <span class="keyword">return</span> config&#x000A;      },&#x000A;      <span class="function">response</span>: <span class="keyword">function</span>(response) {&#x000A;        <span class="predefined">$rootScope</span>.<span class="predefined">$broadcast</span>(<span class="string"><span class="delimiter">'</span><span class="content">loading:hide</span><span class="delimiter">'</span></span>)&#x000A;        <span class="keyword">return</span> response&#x000A;      }&#x000A;    }&#x000A;  })&#x000A;})&#x000A;&#x000A;app.run(<span class="keyword">function</span>(<span class="predefined">$rootScope</span>, <span class="predefined">$ionicLoading</span>) {&#x000A;  <span class="predefined">$rootScope</span>.<span class="predefined">$on</span>(<span class="string"><span class="delimiter">'</span><span class="content">loading:show</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>() {&#x000A;    <span class="predefined">$ionicLoading</span>.show({<span class="key">template</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>})&#x000A;  })&#x000A;&#x000A;  <span class="predefined">$rootScope</span>.<span class="predefined">$on</span>(<span class="string"><span class="delimiter">'</span><span class="content">loading:hide</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>() {&#x000A;    <span class="predefined">$ionicLoading</span>.hide()&#x000A;  })&#x000A;})&#x000A;&#x000A;app.controller(<span class="string"><span class="delimiter">'</span><span class="content">MainCtrl</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(<span class="predefined">$http</span>, <span class="predefined">$ionicLoading</span>) {&#x000A;  <span class="keyword">var</span> _this = <span class="local-variable">this</span>&#x000A;&#x000A;  <span class="predefined">$http</span>.jsonp(<span class="string"><span class="delimiter">'</span><span class="content">http://api.openbeerdatabase.com/v1/breweries.json?callback=JSON_CALLBACK</span><span class="delimiter">'</span></span>).then(<span class="keyword">function</span>(result) {&#x000A;    _this.breweries = result.data.breweries&#x000A;  })&#x000A;})</pre></div>
              </div>
              </div>
              
              <p>There are two things we need to do to make sure this works. First, in our module’s config step, we create the interceptor. Because we cannot inject $ionicLoading as a service into the interceptor, we must instead broadcast an event from $rootScope.</p>
              
              <p>In our app’s main run step, we listen for the appropriate events, and use <code>$ionicLoading</code> to show and hide the modal. When we run this, the effect is the same.</p>
              
              <p>The advantage of this is that our controller or service does not know about the loading screen. We have achieved loose coupling throughout our application, and all of our HTTP requests will act the same throughout the app.</p>
              
              <p>Check out the Scratchpad below for to see it in action!</p>
              <section class='scratchpad'>
                <p>Try this tutorial out below in the Scratchpad:</p>
                <div id='scratch'></div>
              </section>
            </article>
          </div>
        </div>
      </div>
      <footer class='main'>
        <span class='attribution'>&copy; 2014 Drifty Co.</span>
        <span class='expand-wrapper'>
          <span class='expand'></span>
        </span>
        <nav id='nav'>
          <a href='http://ionicframework.com' target='_blank'>Ionic</a>
          <a href='https://github.com/driftyco/ionic' target='_blank'>Github</a>
          <a href='mailto:hi@ionicframework.com' target='_blank'>Contact us</a>
          <a href='https://github.com/driftyco/ionic-learn/issues/new' target='_blank'>Suggestions</a>
          <a href='http://ionicons.com/' target='_blank'>Ionicons</a>
          <a href='http://ionicframework.com/jobs/' target='_blank'>Jobs</a>
          <a href='http://forum.ionicframework.com/' target='_blank'>Forum</a>
          <a href='http://ionicframework.com/blog/' target='_blank'>Blog</a>
          <a href='http://drifty.com' target='_blank'>Drifty Co</a>
        </nav>
      </footer>
    </div>
    <div class='get-ionic-wrapper viewed'>
      <a class='get-ionic' href='http://www.ionicframework.com' target='_new'>Get building with Ionic today!</a>
      <a class='close-cta ion-ios7-close-empty' href='#'></a>
    </div>
    <script src='//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js'></script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js'></script>
    <script src='//scratch.ionicsdk.com/static/js/embed.js'></script>
      <script>
        $(function() {
          var getTemplate = function(url) {
            return $.ajax({url: location.pathname + '/' + url, dataType: 'text'})
          }
        
          $.when(getTemplate('template.html'), getTemplate('style.css'), getTemplate('script.js')).then(function(html, css, js) {
            var scratch = new IonicScratch({
              el: document.getElementById('scratch'),
              width: '100%',
              height: '600px',
              html: html[0],
              css: css[0],
              js: js[0]
            });
          })
        })
      </script>
    <script src='/js/main.js'></script>
  </body>
</html>
